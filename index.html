<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health-e Commerce - Google to Microsoft 365 Migration Cost Savings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f1f5f9;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #1e293b;
            box-shadow: 0 4px 16px rgba(125, 211, 192, 0.3);
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        .logo-text {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .logo-text span:first-child {
            color: #7dd3c0;
        }
        
        .critical-banner {
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%);
            color: #1e293b;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(125, 211, 192, 0.2);
            border: 2px solid rgba(125, 211, 192, 0.3);
        }
        
        .critical-banner .icon {
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 4px 16px rgba(125, 211, 192, 0.3); }
            50% { box-shadow: 0 4px 24px rgba(125, 211, 192, 0.5); }
        }
        
        .dashboard-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            color: #1e293b;
            text-align: center;
            letter-spacing: -0.5px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(125, 211, 192, 0.1);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.15);
            border-color: rgba(125, 211, 192, 0.3);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .icon-users { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
        .icon-dollar { background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%); color: #1e293b; }
        .icon-storage { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); color: #4338ca; }
        .icon-delete { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #dc2626; }
        .icon-mailbox { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #d97706; }
        .icon-percent { background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%); color: #1e293b; }
        
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }
        
        .cost-analysis {
            background: white;
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
            margin-bottom: 30px;
            border: 1px solid rgba(125, 211, 192, 0.1);
        }
        
        .cost-analysis h2 {
            font-size: 24px;
            margin-bottom: 25px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .cost-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .cost-card {
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .cost-card:hover {
            transform: translateY(-2px);
        }
        
        .cost-card.current-google {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
        }
        
        .cost-card.current-microsoft {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }
        
        .cost-card.total-current {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border: 2px solid #6366f1;
        }
        
        .cost-card.optimized {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #10b981;
        }
        
        .cost-card.savings {
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%);
            color: #1e293b;
            border: 2px solid #7dd3c0;
            font-weight: 600;
        }
        
        .cost-card h3 {
            font-size: 16px;
            margin-bottom: 12px;
            opacity: 0.8;
            font-weight: 600;
        }
        
        .cost-amount {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }
        
        .cost-detail {
            font-size: 14px;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .recommendations {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.2);
        }
        
        .recommendations h2 {
            font-size: 24px;
            margin-bottom: 25px;
            color: #7dd3c0;
            font-weight: 700;
            text-align: center;
        }
        
        .recommendation-item {
            display: flex;
            align-items: start;
            gap: 18px;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(125, 211, 192, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(125, 211, 192, 0.2);
            transition: all 0.3s ease;
        }
        
        .recommendation-item:hover {
            background: rgba(125, 211, 192, 0.15);
            transform: translateX(4px);
        }
        
        .recommendation-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%);
            color: #1e293b;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 4px 16px rgba(125, 211, 192, 0.3);
        }
        
        .recommendation-content h3 {
            color: #7dd3c0;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 18px;
        }
        
        .recommendation-content p {
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .user-analysis {
            background: white;
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
            margin-bottom: 30px;
            border: 1px solid rgba(125, 211, 192, 0.1);
        }
        
        .user-analysis h2 {
            font-size: 24px;
            margin-bottom: 25px;
            color: #1e293b;
            font-weight: 700;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border: 2px solid rgba(125, 211, 192, 0.2);
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #7dd3c0;
        }
        
        td {
            padding: 14px 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #1e293b;
        }
        
        tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        tr:nth-child(even) {
            background: #fafbfc;
        }
        
        tr:nth-child(even):hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .migration-timeline {
            background: white;
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
            margin-bottom: 30px;
            border: 1px solid rgba(125, 211, 192, 0.1);
        }
        
        .migration-timeline h2 {
            font-size: 24px;
            margin-bottom: 25px;
            color: #1e293b;
            font-weight: 700;
        }
        
        .timeline-phases {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 25px;
        }
        
        .phase-card {
            padding: 24px;
            border-radius: 12px;
            border-left: 5px solid;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 41, 59, 0.06);
        }
        
        .phase-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.12);
        }
        
        .phase-1 { 
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); 
            border-color: #3b82f6;
        }
        
        .phase-2 { 
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%); 
            border-color: #1e293b;
        }
        
        .phase-3 { 
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); 
            border-color: #10b981;
        }
        
        .phase-card h3 {
            color: #1e293b;
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 18px;
        }
        
        .phase-card ul li {
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 500;
        }
        
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #64748b;
            font-size: 14px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .footer a {
            color: #7dd3c0;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        
        .footer a:hover {
            color: #1e293b;
        }
        
        .error-message {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #ef4444;
            font-weight: 500;
        }
        
        .success-message {
            background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%);
            color: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #7dd3c0;
            font-weight: 600;
        }
        
        @media print {
            .no-print {
                display: none;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üõí</div>
                <div class="logo-text">
                    <span>health</span><span>-e</span> commerce
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 14px; opacity: 0.8;">Migration Analysis Dashboard</div>
                <div style="font-size: 12px; opacity: 0.8;">Created by Dane Busgith</div>
                <div style="font-size: 12px; opacity: 0.6;">Generated: <span id="currentDate"></span></div>
            </div>
        </div>
        
        <div class="critical-banner">
            <span class="icon">üéØ</span>
            <span>Here's the situation: We're currently paying $14,670/month for both Google Workspace AND Microsoft 365 running in parallel. 
            After this migration and some license cleanup, we'll be down to $3,110/month total. That's $11,560 monthly savings. üí∞</span>
        </div>
        
        <h1 class="dashboard-title">Google Workspace to Microsoft 365 Migration Analysis</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon icon-users">üë•</div>
                <div class="stat-value" id="activeUsers">Loading...</div>
                <div class="stat-label">Active Users to Migrate</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-dollar">üí∞</div>
                <div class="stat-value" id="annualSavings">$138,720</div>
                <div class="stat-label">Net Annual Savings</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-storage">üíæ</div>
                <div class="stat-value" id="totalStorage">Loading...</div>
                <div class="stat-label">Total Storage</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-delete">üóëÔ∏è</div>
                <div class="stat-value" id="usersToDelete">Loading...</div>
                <div class="stat-label">Inactive Accounts to Remove</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-mailbox">üìß</div>
                <div class="stat-value" id="largeMailboxes">Loading...</div>
                <div class="stat-label">High-Storage Users (100GB+)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-percent">üìà</div>
                <div class="stat-value" id="costReduction">87.1%</div>
                <div class="stat-label">Cost Reduction</div>
            </div>
        </div>
        
        <div class="cost-analysis">
            <h2>üíµ Current Licensing Costs & Optimization</h2>
            <div class="cost-comparison">
                <div class="cost-card current-google">
                    <h3>‚ùå Google Workspace</h3>
                    <div class="cost-amount">$131,220</div>
                    <div class="cost-detail">237 users annually</div>
                    <hr style="margin: 10px 0; opacity: 0.3;">
                    <div style="font-size: 12px; text-align: left;">
                        Enterprise Plus: ~$466/user/mo<br>
                        237 licenses: $10,935/mo
                    </div>
                </div>
                <div class="cost-card current-microsoft">
                    <h3>‚ö†Ô∏è Current Microsoft</h3>
                    <div class="cost-amount">$44,820</div>
                    <div class="cost-detail">Mixed licenses annually</div>
                    <hr style="margin: 10px 0; opacity: 0.3;">
                    <div style="font-size: 12px; text-align: left;">
                        M365 E5: $57/mo<br>
                        EM+S E5: $16.40/mo<br>
                        Other: Various
                    </div>
                </div>
                <div class="cost-card total-current">
                    <h3>üí∏ Total Current Spend</h3>
                    <div class="cost-amount">$176,040</div>
                    <div class="cost-detail">Google + M365 combined</div>
                    <hr style="margin: 10px 0; opacity: 0.3;">
                    <div style="font-size: 12px;">
                        Monthly: ~$14,670<br>
                        <strong>Eliminate duplicate services!</strong>
                    </div>
                </div>
                <div class="cost-card optimized">
                    <h3>‚úÖ Optimized M365</h3>
                    <div class="cost-amount">$37,320</div>
                    <div class="cost-detail">170 active users optimized</div>
                    <hr style="margin: 10px 0; opacity: 0.3;">
                    <div style="font-size: 12px; text-align: left;">
                        Keep existing E5: $2,542/mo<br>
                        Optimize licensing: -$625/mo<br>
                        Add Exchange P2 (5): +$40/mo
                    </div>
                </div>
                <div class="cost-card savings">
                    <h3>üí∞ Total Savings</h3>
                    <div class="cost-amount">$138,720</div>
                    <div class="cost-detail">Annual reduction</div>
                    <hr style="margin: 10px 0; opacity: 0.3;">
                    <div style="font-size: 12px;">
                        From canceling Google: -$10,935/mo<br>
                        From M365 optimization: -$625/mo<br>
                        Net monthly savings: <strong>$11,560/mo</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="recommendations">
            <h2>üéØ My Recommendations - $138,720 Annual Savings</h2>
            <div class="recommendation-item">
                <div class="recommendation-icon">üí°</div>
                <div class="recommendation-content">
                    <h3>The Big Picture</h3>
                    <p>We're spending $131,220/year on Google Workspace for 237 users, but we already have M365 E5 licenses that include everything Google provides - and more. This migration will save us $138,720 annually. The project pays for itself in the first month, and then it's pure savings moving forward.</p>
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-icon">1</div>
                <div class="recommendation-content">
                    <h3>Leverage Existing Microsoft Licenses</h3>
                    <p>Our current M365 E5 licenses already include Exchange, Teams, SharePoint, and the full Office suite. Instead of buying more licenses, we'll optimize what we have and right-size based on actual usage patterns. This covers 155 active users with full functionality.</p>
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-icon">2</div>
                <div class="recommendation-content">
                    <h3>Handle the High-Storage Users</h3>
                    <p>Five users have mailboxes over 100GB and need Exchange Online Plan 2 ($8/user/month). That's Keri (996GB), Samantha (519GB), Jacob (208GB), Preston (131GB), and Seiya (115GB). Total cost: $40/month for all five - still way less than Google.</p>
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-icon">3</div>
                <div class="recommendation-content">
                    <h3>Clean Up Inactive Accounts</h3>
                    <p>I found 67 accounts that need attention - 36 haven't been used since 2017-2021, and 31 more are questionable. We'll clean these up before migration to optimize our license count and eliminate waste. This is standard practice for any migration project.</p>
                </div>
            </div>
        </div>
        
        <div class="user-analysis">
            <h2>üë• Complete User Analysis</h2>
            
            <div id="loadingMessage" class="success-message" style="display: none;">
                ‚úÖ Successfully loaded all users from JSON file
            </div>
            
            <div id="errorMessage" class="error-message" style="display: none;">
                ‚ùå Error loading user data - showing sample data
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <strong>Total Users in System: <span id="totalUserCount">Loading...</span></strong>
                </div>
                <div>
                    <button onclick="exportToCSV()" style="background: linear-gradient(135deg, #7dd3c0 0%, #5eead4 100%); color: #1e293b; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(125, 211, 192, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 16px rgba(125, 211, 192, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(125, 211, 192, 0.3)'">üì• Export All Users</button>
                </div>
            </div>
            
            <!-- Advanced Filtering Controls -->
            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(125, 211, 192, 0.2);">
                <h3 style="margin-bottom: 15px; color: #1e293b; font-size: 16px;">Filter Users:</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <!-- Status Filter -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Status:</label>
                        <select id="statusFilter" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                            <option value="">All Statuses</option>
                            <option value="Active">Active</option>
                            <option value="Suspended">Suspended</option>
                            <option value="Archived">Archived</option>
                        </select>
                    </div>
                    
                    <!-- Action Filter -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Recommended Action:</label>
                        <select id="actionFilter" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                            <option value="">All Actions</option>
                            <option value="Delete">Delete/Archive</option>
                            <option value="Review">Review for deletion</option>
                            <option value="Standard">Standard migration</option>
                            <option value="Extended">Extended migration window</option>
                            <option value="CRITICAL">CRITICAL: Extended migration window</option>
                            <option value="Convert">Convert to shared mailbox</option>
                        </select>
                    </div>
                    
                    <!-- Storage Filter -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Total Storage:</label>
                        <select id="storageFilter" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                            <option value="">All Storage Sizes</option>
                            <option value="high">100GB+ (Need Plan 2)</option>
                            <option value="medium">10-100GB</option>
                            <option value="low">Under 10GB</option>
                            <option value="empty">No Data (0GB)</option>
                        </select>
                    </div>
                    
                    <!-- Last Login Filter -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Last Login:</label>
                        <select id="loginFilter" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                            <option value="">All Login Times</option>
                            <option value="recent">Last 30 days</option>
                            <option value="active">Last 6 months</option>
                            <option value="old">Over 1 year ago</option>
                            <option value="ancient">Before 2022</option>
                            <option value="never">Never logged in</option>
                        </select>
                    </div>
                </div>
                
                <!-- Search and Reset -->
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="searchInput" placeholder="Search by name or email..." style="padding: 10px 16px; border: 2px solid rgba(125, 211, 192, 0.3); border-radius: 8px; flex: 1; font-size: 14px; transition: border-color 0.2s ease; outline: none;" onfocus="this.style.borderColor='#7dd3c0'" onblur="this.style.borderColor='rgba(125, 211, 192, 0.3)'">
                    <button onclick="resetFilters()" style="background: #6b7280; color: white; padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Clear Filters</button>
                </div>
            </div>
            
            <div style="margin-bottom: 10px;">
                <span id="userCount" style="color: #6b7280;">Loading users...</span>
            </div>
            
            <div class="table-container">
                <table id="userTable">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Last Login</th>
                            <th>Email Storage (GB)</th>
                            <th>Drive Storage (GB)</th>
                            <th>Total Storage (GB)</th>
                            <th>Recommended License</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <tr><td colspan="9" style="text-align: center; padding: 40px;"><div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: #7dd3c0; border-radius: 50%; animation: spin 1s linear infinite;"></div><br><br><span style="color: #64748b; font-weight: 500;">Loading all users...</span></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="migration-timeline">
            <h2>üìÖ Migration Timeline</h2>
            <div class="timeline-phases">
                <div class="phase-card phase-1">
                    <h3>Phase 1: Preparation (Weeks 1-2)</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li>‚úì Clean up inactive accounts (67 users)</li>
                        <li>‚úì Assign proper M365 E5 licenses</li>
                        <li>‚úì Configure Exchange hybrid environment</li>
                        <li>‚úì Set up Azure AD Connect sync</li>
                    </ul>
                </div>
                <div class="phase-card phase-2">
                    <h3>Phase 2: Migration (Weeks 3-6)</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li>‚úì Start with pilot group (10 users)</li>
                        <li>‚úì Migrate standard users (155 people)</li>
                        <li>‚úì Handle high-storage users separately (5 users)</li>
                        <li>‚úì Validate data integrity and functionality</li>
                    </ul>
                </div>
                <div class="phase-card phase-3">
                    <h3>Phase 3: Cutover (Week 7)</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li>‚úì Update MX records for mail routing</li>
                        <li>‚úì Decommission Google Workspace</li>
                        <li>‚úì Complete user training and support</li>
                        <li>‚úì Start saving $11,560/month! üéâ</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Migration Analysis prepared by Dane Busgith | Data sourced from Google Workspace export 7/28/2025</p>
            <p>This dashboard displays all users from the Google Workspace export - complete user inventory included</p>
            <p class="no-print">Questions about this analysis? Contact me: <a href="mailto:dane.busgith@fsastore.com">dane.busgith@fsastore.com</a></p>
        </div>
    </div>
    
    <script>
        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
        
        // Initialize with empty users array - will be populated from JSON
        let users = [];
        
        // Function to determine license recommendation based on storage
        function getLicenseRecommendation(driveGB, emailGB) {
            const totalGB = driveGB + emailGB;
            if (totalGB > 100) {
                return "E5 + Exchange Plan 2";
            } else if (emailGB > 50) {
                return "E5 + Exchange Plan 2";
            } else {
                return "E5 Standard";
            }
        }
        
        // Function to determine action based on user data
        function getAction(user) {
            const totalGB = user.driveGB + user.emailGB;
            
            if (user.status === 'Suspended' || user.status === 'Archived') {
                return 'Delete/Archive';
            }
            if (user.lastLogin.includes('Never') || user.lastLogin < '2022') {
                return 'Review for deletion';
            }
            if (totalGB > 500) {
                return 'CRITICAL: Extended migration window';
            }
            if (totalGB > 200) {
                return 'Migrate with extended window';
            }
            if (totalGB > 100) {
                return 'Migrate overnight';
            }
            if (user.email.includes('info@') || user.email.includes('contacts@')) {
                return 'Convert to shared mailbox';
            }
            return 'Standard migration';
        }
        
        // Populate user table with ALL users
        function populateUserTable(allUsers) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            console.log(`Populating table with ${allUsers.length} users`);
            
            // Update user count display
            document.getElementById('userCount').textContent = `Showing all ${allUsers.length} users`;
            document.getElementById('totalUserCount').textContent = allUsers.length;
            
            // Sort users by total storage descending
            const sortedUsers = allUsers.sort((a, b) => {
                const totalA = (a.driveGB || 0) + (a.emailGB || 0);
                const totalB = (b.driveGB || 0) + (b.emailGB || 0);
                return totalB - totalA;
            });
            
            sortedUsers.forEach((user, index) => {
                const totalStorage = (user.driveGB || 0) + (user.emailGB || 0);
                const license = getLicenseRecommendation(user.driveGB || 0, user.emailGB || 0);
                const action = getAction(user);
                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${user.email}</td>
                    <td>${fullName}</td>
                    <td><span style="background: ${user.status === 'Active' ? '#d1fae5' : '#fee2e2'}; color: ${user.status === 'Active' ? '#10b981' : '#ef4444'}; padding: 2px 8px; border-radius: 4px; font-size: 12px;">${user.status}</span></td>
                    <td>${user.lastLogin}</td>
                    <td style="text-align: right;">${(user.emailGB || 0).toFixed(2)}</td>
                    <td style="text-align: right;">${(user.driveGB || 0).toFixed(2)}</td>
                    <td style="text-align: right; font-weight: ${totalStorage > 100 ? 'bold' : 'normal'}; color: ${totalStorage > 100 ? '#ef4444' : '#333'};">${totalStorage.toFixed(2)}</td>
                    <td>${license}</td>
                    <td>${action}</td>
                `;
            });
            
            console.log(`Successfully populated table with ${sortedUsers.length} users`);
        }
        
        // Update dashboard statistics based on actual data
        function updateDashboardStats(allUsers) {
            console.log(`Updating stats for ${allUsers.length} users`);
            
            // Count active users (logged in within last year)
            const activeUsers = allUsers.filter(u => 
                u.status === 'Active' && 
                u.lastLogin && 
                !u.lastLogin.includes('Never') &&
                new Date(u.lastLogin) > new Date('2024-01-01')
            ).length;
            document.getElementById('activeUsers').textContent = activeUsers;
            
            // Count users to delete (inactive since before 2022 or suspended/archived)
            const usersToDelete = allUsers.filter(u => 
                u.status !== 'Active' || 
                u.lastLogin.includes('Never') ||
                (u.lastLogin && new Date(u.lastLogin) < new Date('2022-01-01'))
            ).length;
            document.getElementById('usersToDelete').textContent = usersToDelete;
            
            // Calculate total storage
            let totalStorageGB = 0;
            allUsers.forEach(u => {
                totalStorageGB += (u.driveGB || 0) + (u.emailGB || 0);
            });
            document.getElementById('totalStorage').textContent = (totalStorageGB / 1024).toFixed(2) + ' TB';
            
            // Count large mailboxes (over 100GB total)
            const largeMailboxes = allUsers.filter(u => {
                const total = (u.driveGB || 0) + (u.emailGB || 0);
                return total > 100;
            }).length;
            document.getElementById('largeMailboxes').textContent = largeMailboxes;
            
            console.log(`Stats updated: ${activeUsers} active, ${usersToDelete} to delete, ${largeMailboxes} large mailboxes`);
        }
        
        // Search and filtering functionality
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const actionFilter = document.getElementById('actionFilter').value;
            const storageFilter = document.getElementById('storageFilter').value;
            const loginFilter = document.getElementById('loginFilter').value;
            
            const rows = document.querySelectorAll('#userTableBody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const cells = row.cells;
                if (!cells || cells.length < 9) return; // Skip loading row
                
                const email = cells[0].textContent.toLowerCase();
                const name = cells[1].textContent.toLowerCase();
                const status = cells[2].textContent.trim();
                const lastLogin = cells[3].textContent;
                const totalStorage = parseFloat(cells[6].textContent);
                const action = cells[8].textContent;
                
                let visible = true;
                
                // Text search
                if (searchTerm && !email.includes(searchTerm) && !name.includes(searchTerm)) {
                    visible = false;
                }
                
                // Status filter
                if (statusFilter && !status.includes(statusFilter)) {
                    visible = false;
                }
                
                // Action filter
                if (actionFilter) {
                    if (actionFilter === 'Delete' && !action.includes('Delete') && !action.includes('Archive')) {
                        visible = false;
                    } else if (actionFilter === 'Review' && !action.includes('Review')) {
                        visible = false;
                    } else if (actionFilter === 'Standard' && !action.includes('Standard')) {
                        visible = false;
                    } else if (actionFilter === 'Extended' && !action.includes('Extended') && !action.includes('overnight')) {
                        visible = false;
                    } else if (actionFilter === 'CRITICAL' && !action.includes('CRITICAL')) {
                        visible = false;
                    } else if (actionFilter === 'Convert' && !action.includes('Convert')) {
                        visible = false;
                    }
                }
                
                // Storage filter
                if (storageFilter) {
                    if (storageFilter === 'high' && totalStorage < 100) {
                        visible = false;
                    } else if (storageFilter === 'medium' && (totalStorage < 10 || totalStorage >= 100)) {
                        visible = false;
                    } else if (storageFilter === 'low' && (totalStorage >= 10 || totalStorage === 0)) {
                        visible = false;
                    } else if (storageFilter === 'empty' && totalStorage !== 0) {
                        visible = false;
                    }
                }
                
                // Login filter
                if (loginFilter) {
                    const loginDate = new Date(lastLogin);
                    const now = new Date();
                    const daysDiff = (now - loginDate) / (1000 * 60 * 60 * 24);
                    
                    if (loginFilter === 'recent' && daysDiff > 30) {
                        visible = false;
                    } else if (loginFilter === 'active' && daysDiff > 180) {
                        visible = false;
                    } else if (loginFilter === 'old' && daysDiff < 365) {
                        visible = false;
                    } else if (loginFilter === 'ancient' && loginDate >= new Date('2022-01-01')) {
                        visible = false;
                    } else if (loginFilter === 'never' && !lastLogin.includes('Never')) {
                        visible = false;
                    }
                }
                
                row.style.display = visible ? '' : 'none';
                if (visible) visibleCount++;
            });
            
            // Update user count display
            const hasFilters = searchTerm || statusFilter || actionFilter || storageFilter || loginFilter;
            if (hasFilters) {
                document.getElementById('userCount').textContent = `Showing ${visibleCount} of ${users.length} users (filtered)`;
            } else {
                document.getElementById('userCount').textContent = `Showing all ${users.length} users`;
            }
        }
        
        // Reset all filters
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('actionFilter').value = '';
            document.getElementById('storageFilter').value = '';
            document.getElementById('loginFilter').value = '';
            applyFilters();
        }
        
        // Add event listeners for all filters
        function setupFilterListeners() {
            document.getElementById('searchInput').addEventListener('keyup', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('actionFilter').addEventListener('change', applyFilters);
            document.getElementById('storageFilter').addEventListener('change', applyFilters);
            document.getElementById('loginFilter').addEventListener('change', applyFilters);
        }
        
        // Export to CSV - exports ALL users
        function exportToCSV() {
            let csv = 'Email,First Name,Last Name,Status,Last Login,Drive (GB),Email (GB),Total Storage (GB),Recommended License,Action\n';
            users.forEach(user => {
                const totalStorage = (user.driveGB || 0) + (user.emailGB || 0);
                const license = getLicenseRecommendation(user.driveGB || 0, user.emailGB || 0);
                const action = getAction(user);
                csv += `"${user.email}","${user.firstName || ''}","${user.lastName || ''}","${user.status}","${user.lastLogin}",${user.driveGB || 0},${user.emailGB || 0},${totalStorage.toFixed(2)},"${license}","${action}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `health-ecommerce_migration_all_users_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Load actual user data from JSON file using fetch() - FIXED VERSION
        async function loadUserData() {
            try {
                console.log('Starting to load user data...');
                
                // Use fetch() instead of window.fs.readFile for Azure Static Web Apps
                const response = await fetch('./User_Download_24072025_221436.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Raw data loaded:', data);
                
                // Extract users from the data structure and convert to our format
                const rawUsers = data.users || [];
                console.log(`Found ${rawUsers.length} raw users in JSON`);
                
                users = rawUsers.map((user, index) => {
                    // Parse storage values from strings like "17.11GB" to numbers
                    const emailUsage = user["Email Usage [READ ONLY]"] || '0GB';
                    const driveUsage = user["Drive Usage [READ ONLY]"] || '0GB';
                    
                    const emailGB = parseFloat(emailUsage.replace('GB', '').replace(',', '') || '0');
                    const driveGB = parseFloat(driveUsage.replace('GB', '').replace(',', '') || '0');
                    
                    return {
                        email: user["Email Address [Required]"] || '',
                        status: user["Status [READ ONLY]"] || '',
                        lastLogin: user["Last Sign In [READ ONLY]"] || '',
                        driveGB: isNaN(driveGB) ? 0 : driveGB,
                        emailGB: isNaN(emailGB) ? 0 : emailGB,
                        firstName: user["First Name [Required]"] || '',
                        lastName: user["Last Name [Required]"] || ''
                    };
                });
                
                console.log(`Successfully processed ${users.length} users`);
                console.log('Sample user:', users[0]);
                
                // Show success message
                document.getElementById('loadingMessage').style.display = 'block';
                document.getElementById('loadingMessage').innerHTML = `‚úÖ Successfully loaded ALL ${users.length} users from JSON file`;
                
                // Update all statistics based on actual data
                updateDashboardStats(users);
                
                // Populate table with ALL users - no limit or pagination
                populateUserTable(users);
                
                // Set up filter event listeners
                setupFilterListeners();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                
                // Show error message
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').innerHTML = `‚ùå Error loading user data: ${error.message}<br>Please ensure User_Download_24072025_221436.json is in the root directory of your site.`;
                
                // Use sample data for demonstration
                users = [
                    { email: "keri.kaiser@fsastore.com", status: "Active", lastLogin: "2025/07/18", driveGB: 978.93, emailGB: 17.11, firstName: "Keri", lastName: "Kaiser" },
                    { email: "samantha.swayze@fsastore.com", status: "Active", lastLogin: "2025/07/21", driveGB: 512.85, emailGB: 6.37, firstName: "Samantha", lastName: "Swayze" },
                    { email: "jacob.medley@fsastore.com", status: "Active", lastLogin: "2025/07/06", driveGB: 206.65, emailGB: 1.59, firstName: "Jacob", lastName: "Medley" },
                    { email: "preston.farrington@fsastore.com", status: "Active", lastLogin: "2025/03/21", driveGB: 94.35, emailGB: 36.35, firstName: "Preston", lastName: "Farrington" },
                    { email: "seiya.vogt@fsastore.com", status: "Active", lastLogin: "2025/07/07", driveGB: 107.43, emailGB: 7.64, firstName: "Seiya", lastName: "Vogt" }
                ];
                
                // Update with sample data
                updateDashboardStats(users);
                populateUserTable(users);
                
                // Set up filter event listeners
                setupFilterListeners();
            }
        }
        
        // Call loadUserData when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting user data load...');
            loadUserData();
        });
    </script>
</body>
</html>
